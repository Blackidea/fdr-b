//Бургер
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').addClass('noscroll');
  $("header").css('top', scroll + 'px');
  $("html").css("overflow-y", "scroll");
}

function unfixscreen() {
  $("body").css('top', "0").removeClass('noscroll');
  $("html").removeAttr("style");
  setTimeout(function(){$("header").css('top', "0"); }, 500);
  $(window).scrollTop(scroll);
}

$(".header__menubutton").click(function(){
	$(".burgermenu").addClass("active");
	if ( $(window).width() > 1023 ) {
    window.scroll = $(window).scrollTop();
    $(".burgermenu").css('top', scroll + 'px');
    $("header").css('top', scroll + 'px');
		$(".page, body").addClass("active");
		$(".header__menubutton").addClass("active");
	}
    fixscreen();
});

$(".burgermenu .close-button, .page .overlay").click(function(){
	$(".burgermenu").removeClass("active");
	if ( $(window).width() > 1023 ) {
		$(".page, body").removeClass("active");
		$(".header__menubutton").removeClass("active");
    setTimeout(function(){$("header").css('top', "0"); }, 500);
	}
    unfixscreen();
});

$(".burgermenu .rentmenu").click(function(){
	$(".burgermenu .lists").hide();
	$(".burgermenu .rent").show();
});

$(".burgermenu .listmenu").click(function(e){
	e.preventDefault();
	$(".burgermenu .rent").hide();
	$(".burgermenu .lists").show();
});

$("a.login").click(function(e){
	e.preventDefault();
	$(".registration").removeClass("active");
	$(".authorization").addClass("active");
});

$(".close-button").click(function(e){
	$(this).parent().removeClass("active");
});

$("a.register").click(function(e){
	e.preventDefault();
	$(".authorization").removeClass("active");
	$(".registration").addClass("active");
});

// Слайдер картинок, блоков и т.д.
$(document).ready(function(){
  $(".owl-carousel").owlCarousel();
});

//Кнопка наверх
$('.toup_button').click(function () {
	$('body, html').animate({scrollTop: 0}, 1200);
});


// Диаграмма в аккаунте
function diagramInit() {
  // Задаем правильную ширину и положение полоскам
  var cellWidth = $(".diagram__header-days li:eq(1)").width();
  $(".diagram__highlight").each(function(){
    var totalWidth, days, startMonth, finalMonth, leftMargin;

    var startDate = $(this).data("from").toString();
    var finalDate = $(this).data("to").toString();
    var startMonth = parseInt(startDate.substr(startDate.length - 2));
    var finalMonth = parseInt(finalDate.substr(finalDate.length - 2));
    var startDay = parseInt(startDate.substring(0, 2));
    var finalDay = parseInt(finalDate.substring(0, 2));

    leftMargin = $(".diagram__header-month[data-month='"+startMonth+"']").position().left + (startDay-1)*cellWidth;
    totalWidth = $(".diagram__header-month[data-month='"+finalMonth+"']").position().left + finalDay*cellWidth - leftMargin;
    $(this).width(totalWidth).css("left", leftMargin);
  });

  function rowHeight() {
    $(".diagram__row").each(function(i){
      $(this).outerHeight( $(".account__alltechnics-list li:nth-of-type("+(i+1)+")").outerHeight() );
    });
  }

  $('[href="#alltechnics"]').click(function(){
  // Задаем правильную высоту строк
    setTimeout(rowHeight,1);
    setTimeout(monthLeft,1);
  });
  $(window).resize(function(){
    rowHeight(); monthLeft();
  });

  // Фиксируем название месяца
  function monthLeft() {
  $(".diagram__header-month").each(function(){
    $(this).attr("data-left", $(this).position().left);
  });
  }

  $(".diagram").scroll(function(){
    var scroll = $(this).scrollLeft();
    $(".diagram__header-month").each(function(){
      if (scroll>$(this).data("left")) {
        var el = $(this).find("span");
        elWidth = el.outerWidth();
        contWidth = $(this).width();
        maxLeft = $(this).width() - elWidth;
        var left = scroll-$(this).data("left");
        if (left > $(this).data("left")+maxLeft) {left = maxLeft}
        el.css("left", left);
      }
    });
  });


  /* ###### Скролл перетаскиванием ###### */

  var x,y,top,left,down;

  $(".diagram").mousedown(function(e){
      down = true;
      x = e.pageX;
      y = e.pageY;
      top = $(".diagram").scrollTop();
      left = $(".diagram").scrollLeft();
      window.firstscrollleft = $(".diagram").scrollLeft();
  });

  $(".diagram").mousemove(function(e){
      if(down){
          var newX = e.pageX;
          var newY = e.pageY;

          $(".diagram").scrollTop(top - newY + y);
          $(".diagram").scrollLeft(left - newX + x);
          window.newscroll = $(".diagram").scrollLeft();
      }
  });

  $(".diagram").mouseup(function(e){down = false;});

  //////

  $("[data-diagram]").click(function(){
    var action = $(this).data("diagram");
    var newscroll;
    if (action === "next") {
      var length = 200;
    } else {
      var length = -200;
    }
    newscroll = length + $(".diagram").scrollLeft();
    if (newscroll < 0) {newscroll = 0}
    if (newscroll > $(".diagram__wrapper").outerWidth()-$(".diagram").outerWidth()) {newscroll = $(".diagram__wrapper").outerWidth()-$(".diagram").outerWidth()}

    $(".diagram").stop().animate({scrollLeft: newscroll}, 700, "easeOutCubic");
  });

}

diagramInit();


//Переключатель блоков в FAQ
$(document).ready(function(){
	$(".faq__details").hide();
});

$(".faq__categorylist a").click(function(e){
	e.preventDefault();
	var href = $(this).attr("href");

	$(".faq__categorylist a.active").removeClass("active");
	$(this).addClass("active");
		$(this).siblings(".faq__hiddenlist").slideToggle();
	$(this).parent().siblings().find(".faq__hiddenlist").slideUp();
	if ( $(window).width() < 1024 ) {
		$(".faq__popular").hide();
		$(".faq__categorylist").hide();
		$(""+href+"").show();
	} else {
		$(".faq__popular").hide();
		$(".faq__details").hide();
		$(""+href+"").show();
	}
});

$(".faq__popularlist a").click(function(e){
	e.preventDefault();
	var href = $(this).attr("href");
	if ( $(window).width() < 1024 ) {
		$(".faq__popular").hide();
		$(".faq__categorylist").hide();
		$(""+href+"").show();
	} else {
		$(".faq__popular").hide();
		$(".faq__details").hide();
		$(""+href+"").show();
	}
});

$(".faq__detailstoptext a").click(function(e){
	e.preventDefault();
	$(".faq__details").hide();
	$(".faq__popular").show();
	$(".faq__categorylist").show();
	$(".faq__categorylist a.active").removeClass("active");
});



//Переключатель блоков на странице выдачи поиска
$('.searchresult__buttons a[href="#map"]').click(function(e){
	e.preventDefault();
	$(".searchresult__cards").hide();
	$(".searchresult__map").show();
	$('.searchresult__buttons a[href="#map"]').hide();
	$('.searchresult__buttons a[href="#list"]').show();
});

$('.searchresult__buttons a[href="#list"]').click(function(e){
	e.preventDefault();
	$(".searchresult__map").hide();
	$(".searchresult__cards").show();
	$('.searchresult__buttons a[href="#list"]').hide();
	$('.searchresult__buttons a[href="#map"]').show();
});


// Самописный слайдер
customslider();

function customslider() {
	$(".slider").each(function(){
		var slideamount = $(this).find(".slide").length;
		$(this).find(".wrapper").css("width", slideamount*100+"%");
		$(this).find(".slide").css("width", 100/slideamount+"%");
	});
}

// Переключение слайдов (стрелочки)
$(".slider .arrow").click(function() {
	var slideamount = $(this).parents(".slider").find(".slide").length;
	var currentslide = parseInt($(this).parents(".slider").find(".slide.active") .attr("data-slide"));
	if ($(this).hasClass("left")) {
		currentslide -= 1;
		if (currentslide < 1) {currentslide = 1;}
	}
	if ($(this).hasClass("right")) {
		currentslide += 1;
		if (currentslide > slideamount) {currentslide = slideamount;}
	}
	$(this).parents(".slider").find(".wrapper").css("left", "-"+(100*(currentslide-1))+"%");	$(this).parents(".slider").find(".slide.active").removeClass("active");
	$(this).parents(".slider").find('.slide[data-slide='+currentslide+']').addClass("active");	$(this).parents(".slider").find(".dot.active").removeClass("active");
	$(this).parents(".slider").find('.dot[data-slide='+currentslide+']').addClass("active");
});

//Переключение слайдов (точки)
$(".slider .dot").click(function(){
	$(this).parents(".slider").find(".dot.active").removeClass("active");
   	var newslide = $(this).attr("data-slide");
   	$(this).parents(".slider").find(".wrapper").css("left", "-"+(100*(newslide-1))+"%");	$(this).parents(".slider").find(".slide.active").removeClass("active");
	$(this).parents(".slider").find('.slide[data-slide='+newslide+']').addClass("active");
	$(this).parents(".slider").find('.dot[data-slide='+newslide+']').addClass("active");
});




//Перезагрузка страницы при переходе на мобильную версию и обратно
window.desktop;
window.newdesktop;

function checkpagewidth() {
    if ( $(window).width() > 768 ) {
        desktop = true;
    } else { desktop = false; }

    $(window).resize(function(){
        if ( $(window).width() > 768 ) {
            newdesktop = true;
        } else { newdesktop = false; }

        if ( newdesktop != desktop ) {
            location.reload();
        }
    });
}




// Плавное появление блоков при скролле
window.sr = ScrollReveal();
var fooReveal = {delay: 100, distance: '40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
sr.reveal('sr', fooReveal);




// Параллакс бекграунда (во втором блоке)
function scrollsecond() {
    var el = $("section.second");
    var h1 = el.offset().top;
    var sectionheight = el.height();
    var scroll = $(window).scrollTop();
    if ( (scroll > (h1 - $(window).height())) ) {
        var percents = scroll/sectionheight;
        $("section.second .bg").css("top", (200-percents*150)+"px");
    }
}




// Фиксировать экран для самописных модальных окон
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').toggleClass('noscroll');
}

function unfixscreen() {
  $("body").css('top', "0").toggleClass('noscroll');
  $(window).scrollTop(scroll);
}




// Кастомный селектбокс (selectBoxIt)
$("#select").selectBoxIt();

// Кастомный селектбокс (jQuery UI)
$(".selectmenu").selectmenu();


// Показ прелоадера при отправке формы
$(document).on({
  ajaxStart: function() { $(".preloader").addClass("active");},
  ajaxStop: function() { $(".preloader").removeClass("active");}
});




// Плавно скрыть/показать блок
function hideblock(el) {
  setTimeout(function() {$(el).show();}, 700);
  setTimeout(function() {$(el).css("opacity", "1");}, 900);
}

function showblock(el) {
  setTimeout(function() {$(el).css("opacity", "0");}, 700);
  setTimeout(function() {$(el).show();}, 900);
}



// LazyLoad + Masonry (+imagesLoaded)
$(".lazy").lazyload({
    effect: 'fadeIn',
    effectspeed: 1000,
    threshold: 200
});




// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});




// Добавить в избранное
function addtobookmarks() {
    var url = $("#tofavourites p").text();

    if (window.sidebar && window.sidebar.addPanel) { // Mozilla Firefox Bookmark
      window.sidebar.addPanel(document.title, url, '');
    } else if (window.external && ('AddFavorite' in window.external)) { // IE Favorite
      window.external.AddFavorite(url, document.title);
    } else if (window.opera && window.print) { // Opera Hotlist
      this.title = document.title;
      return true;
    } else { // webkit - safari/chrome
      alert('Нажмите ' + (navigator.userAgent.toLowerCase().indexOf('mac') != -1 ? 'Command/Cmd' : 'CTRL') + ' + D, чтобы добавить страницу в закладки.');
    }
}





// Всплывающие окна
$(".fancybox").fancybox({
    fitToView   : false,
    autoSize    : true,
    openEffect  : 'fade',
    closeEffect : 'fade',
});





// Всплывающая галерея картинок
$(".fancyimage").fancybox({
    fitToView   : true,
    autoSize    : true,
    openEffect  : 'fade',
    closeEffect : 'fade',
});




// Проверка формы на правильность введенных данных
$(".fake-button").click(function(){
    window.activeform = $(this).parents("form").attr("id");

    checkselects();
    checkinputs();
    checkandsubmit();
});

// 1. Проверка селектов
function checkselects() {
    if (select1val === false) { $('#'+activeform+' select[name="city"]').parent().addClass("error"); }
    if (select2val === false) { $('#'+activeform+' select[name="clienttype"]').parent().addClass("error"); }
    if (select3val === false) { $('#'+activeform+' select[name="orgform"]').parent().addClass("error"); }
}

// 2. Проверка текстовых input'ов
function checkinputs() {
    // Проверка обычных полей на заполненность
    checkempty();

    // Проверка поля email
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }
    if ( isEmail($('#'+activeform+' input[name="email"]').val()) === false) {
        $('#'+activeform+' input[name="email"]').parent().addClass("error")
    } else {$('#'+activeform+' input[name="email"]').parent().removeClass("error")}
}

// 3. Проверка на ошибочные поля и отправка формы
function checkandsubmit() {
    window.formerrors = 0;
    $('#'+activeform).find("div.error").each(function(){
        formerrors += 1;
    });
    if (formerrors === 0) {
        $('#'+activeform).submit();
    }
}

// Скрипт проверки на пустое значение
function checkempty() {
    $('#'+activeform+' input[data-required]').each(function(){
        if (!$(this).val()) {
            $(this).parent().addClass("error")
        } else {$(this).parent().removeClass("error")}
    });
}

// Проверка номера телефона
function phonenumerlength() {
   if ( $('#'+activeform+' input[name="tel"]').val().match(/\d/g).length < 11) {
       $('#'+activeform+' input[name="tel"]').addClass("error")
   } else {$('#'+activeform+' input[name="tel"]').removeClass("error")}
}

// Убрать ошибку при изменении input'а
$("input").on("keyup change", function(){
   $(this).parent().removeClass("error");
});

// Только цифры в input'е
$('.onlynumber').change(function(e){
  if (/\D/g.test(this.value))
  {
    this.value = this.value.replace(/\D/g, '');
  }
});





// AJAX форма
$(document).ready(function() {
    $('#subscribeform').ajaxForm(function() {
        // Успешная отправка формы
        $.fancybox([{href : '#success', fitToView   : false, autoSize    : true, openEffect  : 'fade', closeEffect : 'fade',}]);
    });
});




// Переход названия поля в активное состояние
$("input, textarea").focus(function(){
   window.nowform = $(this).closest("form").attr("id");
   $(this).prev().addClass('active');
});

$("input, textarea, select").on("blur change", function(){
    window.nowform = $(this).closest("form").attr("id");
   if ($(this).val() === "") {
       $(this).prev().removeClass('active');
   }
});




//  Добавляем/убираем тень при длинном value в input
$("input[name='seller']").on("keyup change", function(){
    if ($(this).val().length > 35) {
        $(this).parents("form").addClass("filled");
    } else {$(this).parents("form").removeClass("filled");}
});




// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+7 (999) 999-99-99");
});




//Перевод языка
function translatepage() {
	window.aLangKeys=new Array();
	aLangKeys['us']=new Array();
	aLangKeys['de']=new Array();
	aLangKeys['es']=new Array();
	aLangKeys['it']=new Array();
	aLangKeys['fr']=new Array();
	aLangKeys['jp']=new Array();

	aLangKeys['us']['languagename']='English';
	aLangKeys['de']['languagename']='Deutsch';
	aLangKeys['es']['languagename']='Español';
	aLangKeys['it']['languagename']='Italiano';
	aLangKeys['fr']['languagename']='Français';
	aLangKeys['jp']['languagename']='フランス語';
}

// Скрипт перевода языка
$(document).ready(function() {
    $('[data-lang]').click( function() {
		translatepage();
        window.lang = $(this).attr('data-lang'); // obtain language id
        // translate all translatable elements
        $('[data-key]').each(function(i){
          $(this).text(aLangKeys[lang][ $(this).attr('data-key') ]);
        });
    });
});







 /* НОВОЕ ###################### */

//Личный кабинет

//Переключение по вкладкам
$('.account__navigation a[href="#orders"]').click(function(e){
	e.preventDefault();
	$(this).parents("ul").find("li.active").removeClass("active");
	$(this).parents("li").addClass("active");
	$(".account__messages").hide();
	$(".account__settings").hide();
	$(".account__alltechnics").hide();
	$(".account__technics").hide();
	$(".account__operators").hide();
	$(".account__orders").show();
})

$('.account__navigation a[href="#messages"]').click(function(e){
	e.preventDefault();
	$(this).parents("ul").find("li.active").removeClass("active");
	$(this).parents("li").addClass("active");
	$(".account__orders").hide();
	$(".account__settings").hide();
	$(".account__alltechnics").hide();
	$(".account__technics").hide();
	$(".account__operators").hide();
	$(".account__messages").show();
})

$('.account__navigation a[href="#settings"]').click(function(e){
	e.preventDefault();
	$(this).parents("ul").find("li.active").removeClass("active");
	$(this).parents("li").addClass("active");
	$(".account__messages").hide();
	$(".account__orders").hide();
	$(".account__alltechnics").hide();
	$(".account__technics").hide();
	$(".account__operators").hide();
	$(".account__settings").show();
})

$('.account__navigation a[href="#alltechnics"]').click(function(e){
	e.preventDefault();
	$(this).parents("ul").find("li.active").removeClass("active");
	$(this).parents("li").addClass("active");
	$(".account__messages").hide();
	$(".account__orders").hide();
	$(".account__settings").hide();
	$(".account__technics").hide();
	$(".account__operators").hide();
	$(".account__alltechnics").show();
})

//active

$('.account__navigation a[href="#technics"]').click(function(e){
	e.preventDefault();
	$(this).parents("ul").find("li.active").removeClass("active");
	$(this).parents("li").addClass("active");
	$(".account__messages").hide();
	$(".account__orders").hide();
	$(".account__settings").hide();
	$(".account__alltechnics").hide();
	$(".account__operators").hide();
	$(".account__technics").show();
})

$('.account__navigation a[href="#operators"]').click(function(e){
	e.preventDefault();
	$(this).parents("ul").find("li.active").removeClass("active");
	$(this).parents("li").addClass("active");
	$(".account__messages").hide();
	$(".account__orders").hide();
	$(".account__settings").hide();
	$(".account__alltechnics").hide();
	$(".account__technics").hide();
	$(".account__operators").show();
})


//Закрывающие документы
$('.account__order-documents a[href="#moredocs"]').click(function(e){
	e.preventDefault();
	$(this).parent().addClass("active");
	$(".account__order-documentslist").slideDown();
})

//Просмотреть заказ
$('.account__orders-list a[href="#orderinfo"]').click(function(e){
	e.preventDefault();
	$(".account__orders").hide();
	$(".account__orderinfo").show();
})

//Назад ко всем заказам
$('.account__orderinfo a[href="#orders"]').click(function(e){
	e.preventDefault();
	$(".account__orderinfo").hide();
	$(".account__orders").show();
})

//Добавить ответ в обращении
$('a.account__add-answer').click(function(e){
	e.preventDefault();
	$(this).next().show();
	$(this).find('.icon').text("-");
})

//Просмотреть обращение
$('.account__message-list a[href="#message-info"]').click(function(e){
	e.preventDefault();
	$(".account__messages").hide();
	$(".account__message-info").show();
})

//Назад ко всем обращениям
$('.account__message-info a[href="#messages"]').click(function(e){
	e.preventDefault();
	$(".account__message-info").hide();
	$(".account__messages").show();
})

//Просмотреть технику
$('.account__technics-list a[href="#technics-info"]').click(function(e){
	e.preventDefault();
	$(".account__technics").hide();
	$(".account__technics-info").show();
})

//Назад ко всей технике
$('.account__technics-info a[href="#technics"]').click(function(e){
	e.preventDefault();
	$(".account__technics-info").hide();
	$(".account__technics").show();
})

//Просмотреть оператора
$('.account__operators-cards a[href="#operators-info"]').click(function(e){
	e.preventDefault();
	$(".account__operators").hide();
	$(".account__operators-info").show();
})

//Назад ко всем операторам
$('.account__operators-info a[href="#operators"]').click(function(e){
	e.preventDefault();
	$(".account__operators-info").hide();
	$(".account__operators").show();
})

//Календарь
$.datepicker.setDefaults( $.datepicker.regional[ "ru" ] );

$(".calendar").click(function(e){
	e.preventDefault();
	$(".datepicker").datepicker({
		monthNames: ['Январь', 'Февраль', 'Март', 'Апрель',
		'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь',
		'Октябрь', 'Ноябрь', 'Декабрь'],
 		dayNamesMin: ['Вс','Пн','Вт','Ср','Чт','Пт','Сб'],
 		firstDay: 1,
	});
});

// Аккордион
$("[data-accordion]").click(function(){
    var target = $(this).data("accordion");
    $(this).toggleClass("active");
    $("#"+target).slideToggle();
});

// Показать поиск в хедере
function toggleheadersearch() {
    $("header .searchform").toggleClass("active");
}

function hideheadersearch() {
    $("header .searchform").removeClass("active");
}

$(".header").click(function(event){
  event.stopPropagation();
});

$("html").click(function(){
  if (!$(".header__searchform").hasClass("activesearch")) {
  hideheadersearch();  
  }
});

$("[data-action='toggleheadersearch']").click(function(e){
    e.preventDefault();
    toggleheadersearch();
});

// Бургер чтоб не перепрыгивал слева направо при ресайзе окна
function burgerjump(){
    var el = $(".burgermenu");
    var win = $(window);
    var width = win.width();
    var newidth;
    win.resize(function(){
        newidth = win.width();
        if (newidth != width) {
            width = newidth;
            el.css("visibility", "hidden");
            setTimeout(function(){
                el.removeAttr("style");
            },500);
        }
    });
};

burgerjump();
